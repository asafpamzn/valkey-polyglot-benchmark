name: Track External Valkey Mentions

on:
  workflow_dispatch:  # Allows manual execution
  schedule:
    - cron: "0 * * * *" # Runs every hour

jobs:
  search_mentions:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Search GitHub Mentions and Show Repo Star Counts
        run: |
          LAST_DAY=$(date -d "1 day ago" +"%Y-%m-%d")
          echo "ğŸ” Searching for 'valkey' mentions since $LAST_DAY..."

          # Fetch issues/PRs and process each result
          curl -s "https://api.github.com/search/issues?q=valkey+-repo:valkey-io/valkey+-repo:valkey-io/valkey-glide+-repo:glide-for-redis+-repo:valkey-glide+-repo:github-trending-repos+updated:>$LAST_DAY&per_page=100" |
          jq -r '.items[] | .html_url' |
          while read -r url; do
            echo "ğŸ”— $url"
            repo=$(echo "$url" | awk -F/ '{print $4 "/" $5}')
            stars=$(curl -s "https://api.github.com/repos/$repo" | jq '.stargazers_count')
            echo "â­ Repo: $repo has $stars stars"
            echo ""
          done
